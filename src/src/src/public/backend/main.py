# === ุงูุฎุทูุฉ 1: ุงุณุชูุฑุงุฏ ุงูุฃุฏูุงุช ุงููุงุฒูุฉ ===
# FastAPI ูู ุงูุฅุทุงุฑ ุงูุฐู ุณูุจูู ุจู "ุงููุทุจุฎ" ุงูุฎุงุต ุจูุง
from fastapi import FastAPI, HTTPException
# Pydantic ูุณุงุนุฏูุง ุนูู ุงูุชุญูู ูู ุงูุจูุงูุงุช ุงููุงุฏูุฉ ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ
from pydantic import BaseModel
# ุฃุฏูุงุช ููุชุนุงูู ูุน ุงูููุช ูุงูุงุฎุชูุงุฑ ุงูุนุดูุงุฆู
import time
import random
# ุฃุฏุงุฉ ูููุฉ ููุณูุงุญ ูููุงุฌูุฉ ุงูุฃูุงููุฉ ุจุงูุชุญุฏุซ ูุน ุงูููุงูุฉ ุงูุฎูููุฉ
from fastapi.middleware.cors import CORSMiddleware

# === ุงูุฎุทูุฉ 2: ุฅูุดุงุก ุชุทุจูู "ุงููุทุจุฎ" ===
app = FastAPI(title="MindForge AI API", description="API ูุชุญููู ุงููุต ุฅูู ููุฏูู")

# === ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ููุงุนุฏ ุงูุณูุงุญ ุจุงูุงุชุตุงู (CORS) ===
# ูุฐุง ุงูุฌุฒุก ููู ุฌุฏูุง ููุณูุงุญ ููููุนูุง (Vercel) ุจุงูุงุชุตุงู ุจุงูุฎุงุฏู (Render)
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ูู ุงูุชุทุจูู ุงูุญููููุ ุถุน ููุง ุฑุงุจุท ูููุนู ุนูู Vercel
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# === ุงูุฎุทูุฉ 4: ุชุญุฏูุฏ ุดูู ุงูุทูุจ ุงูุฐู ูุชููุน ุงุณุชูุงูู ===
# ูุญู ูุชููุน ุฃู ูุฑุณู ููุง ุงููุณุชุฎุฏู ูุตูุง (prompt)
class VideoRequest(BaseModel):
    prompt: str

# === ุงูุฎุทูุฉ 5: ุฅูุดุงุก ูุงุฆูุฉ ุจููุฏูููุงุช ููููุฉ ููุงุฎุชุจุงุฑ ===
# ูู ุงููุงูุนุ ุณูุชู ุงุณุชุจุฏุงู ูุฐู ุงูุฑูุงุจุท ุจููุฏูููุงุช ุญููููุฉ ูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู
MOCK_VIDEO_URLS = [
    "https://sample-videos.com/video321/mp4/720/big_buck_bunny_720p_1mb.mp4",
    "https://sample-videos.com/video321/mp4/480/big_buck_bunny_480p_1mb.mp4",
    "https://www.w3schools.com/html/mov_bbb.mp4"
]

# === ุงูุฎุทูุฉ 6: ุจูุงุก ูุธููุฉ ุชูููุฏ ุงูููุฏูู (ุงููุธููุฉ ุงูููููุฉ) ===
# ูุฐู ุงููุธููุฉ ุชุญุงูู ุนูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูุญูููู
def generate_ai_video(prompt: str) -> str:
    print(f"๐ฅ ุงุณุชูุงู ุทูุจ ุชูููุฏ ููุฏูู ูููุต: '{prompt}'")
    
    # ูุญุงูุงุฉ ุงูููุช ุงูุฐู ุชุณุชุบุฑูู ุนูููุฉ ุงูุชูููุฏ (ุณููุชุธุฑ 5 ุซูุงูู)
    print("โณ ุฌุงุฑู ุงูุชูููุฏ... ูุฏ ูุณุชุบุฑู ูุฐุง ุจุนุถ ุงูููุช.")
    time.sleep(5) 
    
    # ุงุฎุชูุงุฑ ููุฏูู ุนุดูุงุฆู ูู ุงููุงุฆูุฉ ุงูููููุฉ
    video_url = random.choice(MOCK_VIDEO_URLS)
    print(f"โ ุชู ุชูููุฏ ุงูููุฏูู ุงููููู: {video_url}")
    
    return video_url

# === ุงูุฎุทูุฉ 7: ุฅูุดุงุก ููุทุฉ ุงูููุงูุฉ (API Endpoint) ===
# ูุฐุง ูู "ุงูุจุงุจ" ุงูุฐู ุชุณุชุฎุฏูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ูุทูุจ ุชูููุฏ ุงูููุฏูู
@app.post("/generate-video/")
async def create_video(request: VideoRequest):
    # ุงูุชุญูู ูู ุฃู ุงููุต ููุณ ูุงุฑุบูุง
    if not request.prompt.strip():
        raise HTTPException(status_code=400, detail="ุงููุต ุงููุฏุฎู ูุง ูููู ุฃู ูููู ูุงุฑุบูุง.")

    try:
        # ุงุณุชุฏุนุงุก ูุธููุฉ ุชูููุฏ ุงูููุฏูู
        video_url = generate_ai_video(request.prompt)
        
        # ุฅุฑุฌุงุน ุฑุงุจุท ุงูููุฏูู ูู ุงุณุชุฌุงุจุฉ ุจุตูุบุฉ JSON
        return {"message": "ุชู ุชูููุฏ ุงูููุฏูู ุจูุฌุงุญ!", "video_url": video_url}
    
    except Exception as e:
        # ูู ุญุงูุฉ ุญุฏูุซ ุฃู ุฎุทุฃ
        raise HTTPException(status_code=500, detail=f"ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุชูููุฏ ุงูููุฏูู: {e}")

# === ููุทุฉ ููุงูุฉ ุจุณูุทุฉ ููุชุญูู ูู ุฃู "ุงููุทุจุฎ" ูุนูู ===
@app.get("/")
def read_root():
    return {"message": "ูุฑุญุจุงู ุจู ูู MindForge API - ุงููุทุจุฎ ูุนูู ุจูุงูู ุทุงูุชู!"}
